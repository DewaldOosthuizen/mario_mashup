[gd_scene load_steps=97 format=2]

[ext_resource path="res://resources/Characters/zombiefiles/png/female/Dead (1).png" type="Texture" id=1]
[ext_resource path="res://resources/Characters/zombiefiles/png/female/Dead (2).png" type="Texture" id=2]
[ext_resource path="res://resources/Characters/zombiefiles/png/female/Dead (3).png" type="Texture" id=3]
[ext_resource path="res://resources/Characters/zombiefiles/png/female/Dead (4).png" type="Texture" id=4]
[ext_resource path="res://resources/Characters/zombiefiles/png/female/Dead (5).png" type="Texture" id=5]
[ext_resource path="res://resources/Characters/zombiefiles/png/female/Dead (6).png" type="Texture" id=6]
[ext_resource path="res://resources/Characters/zombiefiles/png/female/Dead (7).png" type="Texture" id=7]
[ext_resource path="res://resources/Characters/zombiefiles/png/female/Dead (8).png" type="Texture" id=8]
[ext_resource path="res://resources/Characters/zombiefiles/png/female/Dead (9).png" type="Texture" id=9]
[ext_resource path="res://resources/Characters/zombiefiles/png/female/Dead (10).png" type="Texture" id=10]
[ext_resource path="res://resources/Characters/zombiefiles/png/female/Dead (11).png" type="Texture" id=11]
[ext_resource path="res://resources/Characters/zombiefiles/png/female/Dead (12).png" type="Texture" id=12]
[ext_resource path="res://resources/Characters/zombiefiles/png/female/Attack (1).png" type="Texture" id=13]
[ext_resource path="res://resources/Characters/zombiefiles/png/female/Attack (2).png" type="Texture" id=14]
[ext_resource path="res://resources/Characters/zombiefiles/png/female/Attack (3).png" type="Texture" id=15]
[ext_resource path="res://resources/Characters/zombiefiles/png/female/Attack (4).png" type="Texture" id=16]
[ext_resource path="res://resources/Characters/zombiefiles/png/female/Attack (5).png" type="Texture" id=17]
[ext_resource path="res://resources/Characters/zombiefiles/png/female/Attack (6).png" type="Texture" id=18]
[ext_resource path="res://resources/Characters/zombiefiles/png/female/Attack (7).png" type="Texture" id=19]
[ext_resource path="res://resources/Characters/zombiefiles/png/female/Attack (8).png" type="Texture" id=20]
[ext_resource path="res://resources/Characters/zombiefiles/png/male/Dead (1).png" type="Texture" id=21]
[ext_resource path="res://resources/Characters/zombiefiles/png/male/Dead (2).png" type="Texture" id=22]
[ext_resource path="res://resources/Characters/zombiefiles/png/male/Dead (3).png" type="Texture" id=23]
[ext_resource path="res://resources/Characters/zombiefiles/png/male/Dead (4).png" type="Texture" id=24]
[ext_resource path="res://resources/Characters/zombiefiles/png/male/Dead (5).png" type="Texture" id=25]
[ext_resource path="res://resources/Characters/zombiefiles/png/male/Dead (6).png" type="Texture" id=26]
[ext_resource path="res://resources/Characters/zombiefiles/png/male/Dead (7).png" type="Texture" id=27]
[ext_resource path="res://resources/Characters/zombiefiles/png/male/Dead (8).png" type="Texture" id=28]
[ext_resource path="res://resources/Characters/zombiefiles/png/male/Dead (9).png" type="Texture" id=29]
[ext_resource path="res://resources/Characters/zombiefiles/png/male/Dead (10).png" type="Texture" id=30]
[ext_resource path="res://resources/Characters/zombiefiles/png/male/Dead (11).png" type="Texture" id=31]
[ext_resource path="res://resources/Characters/zombiefiles/png/male/Dead (12).png" type="Texture" id=32]
[ext_resource path="res://resources/Characters/zombiefiles/png/male/Idle (1).png" type="Texture" id=33]
[ext_resource path="res://resources/Characters/zombiefiles/png/male/Idle (2).png" type="Texture" id=34]
[ext_resource path="res://resources/Characters/zombiefiles/png/male/Idle (3).png" type="Texture" id=35]
[ext_resource path="res://resources/Characters/zombiefiles/png/male/Idle (4).png" type="Texture" id=36]
[ext_resource path="res://resources/Characters/zombiefiles/png/male/Idle (5).png" type="Texture" id=37]
[ext_resource path="res://resources/Characters/zombiefiles/png/male/Idle (6).png" type="Texture" id=38]
[ext_resource path="res://resources/Characters/zombiefiles/png/male/Idle (7).png" type="Texture" id=39]
[ext_resource path="res://resources/Characters/zombiefiles/png/male/Idle (8).png" type="Texture" id=40]
[ext_resource path="res://resources/Characters/zombiefiles/png/male/Idle (9).png" type="Texture" id=41]
[ext_resource path="res://resources/Characters/zombiefiles/png/male/Idle (10).png" type="Texture" id=42]
[ext_resource path="res://resources/Characters/zombiefiles/png/male/Idle (11).png" type="Texture" id=43]
[ext_resource path="res://resources/Characters/zombiefiles/png/male/Idle (12).png" type="Texture" id=44]
[ext_resource path="res://resources/Characters/zombiefiles/png/male/Idle (13).png" type="Texture" id=45]
[ext_resource path="res://resources/Characters/zombiefiles/png/male/Idle (14).png" type="Texture" id=46]
[ext_resource path="res://resources/Characters/zombiefiles/png/male/Idle (15).png" type="Texture" id=47]
[ext_resource path="res://resources/Characters/zombiefiles/png/female/Walk (1).png" type="Texture" id=48]
[ext_resource path="res://resources/Characters/zombiefiles/png/female/Walk (2).png" type="Texture" id=49]
[ext_resource path="res://resources/Characters/zombiefiles/png/female/Walk (3).png" type="Texture" id=50]
[ext_resource path="res://resources/Characters/zombiefiles/png/female/Walk (4).png" type="Texture" id=51]
[ext_resource path="res://resources/Characters/zombiefiles/png/female/Walk (5).png" type="Texture" id=52]
[ext_resource path="res://resources/Characters/zombiefiles/png/female/Walk (6).png" type="Texture" id=53]
[ext_resource path="res://resources/Characters/zombiefiles/png/female/Walk (7).png" type="Texture" id=54]
[ext_resource path="res://resources/Characters/zombiefiles/png/female/Walk (8).png" type="Texture" id=55]
[ext_resource path="res://resources/Characters/zombiefiles/png/female/Walk (9).png" type="Texture" id=56]
[ext_resource path="res://resources/Characters/zombiefiles/png/female/Walk (10).png" type="Texture" id=57]
[ext_resource path="res://resources/Characters/zombiefiles/png/male/Attack (1).png" type="Texture" id=58]
[ext_resource path="res://resources/Characters/zombiefiles/png/male/Attack (2).png" type="Texture" id=59]
[ext_resource path="res://resources/Characters/zombiefiles/png/male/Attack (3).png" type="Texture" id=60]
[ext_resource path="res://resources/Characters/zombiefiles/png/male/Attack (4).png" type="Texture" id=61]
[ext_resource path="res://resources/Characters/zombiefiles/png/male/Attack (5).png" type="Texture" id=62]
[ext_resource path="res://resources/Characters/zombiefiles/png/male/Attack (6).png" type="Texture" id=63]
[ext_resource path="res://resources/Characters/zombiefiles/png/male/Attack (7).png" type="Texture" id=64]
[ext_resource path="res://resources/Characters/zombiefiles/png/male/Attack (8).png" type="Texture" id=65]
[ext_resource path="res://resources/Characters/zombiefiles/png/female/Idle (1).png" type="Texture" id=66]
[ext_resource path="res://resources/Characters/zombiefiles/png/female/Idle (2).png" type="Texture" id=67]
[ext_resource path="res://resources/Characters/zombiefiles/png/female/Idle (3).png" type="Texture" id=68]
[ext_resource path="res://resources/Characters/zombiefiles/png/female/Idle (4).png" type="Texture" id=69]
[ext_resource path="res://resources/Characters/zombiefiles/png/female/Idle (5).png" type="Texture" id=70]
[ext_resource path="res://resources/Characters/zombiefiles/png/female/Idle (6).png" type="Texture" id=71]
[ext_resource path="res://resources/Characters/zombiefiles/png/female/Idle (7).png" type="Texture" id=72]
[ext_resource path="res://resources/Characters/zombiefiles/png/female/Idle (8).png" type="Texture" id=73]
[ext_resource path="res://resources/Characters/zombiefiles/png/female/Idle (9).png" type="Texture" id=74]
[ext_resource path="res://resources/Characters/zombiefiles/png/female/Idle (10).png" type="Texture" id=75]
[ext_resource path="res://resources/Characters/zombiefiles/png/female/Idle (11).png" type="Texture" id=76]
[ext_resource path="res://resources/Characters/zombiefiles/png/female/Idle (12).png" type="Texture" id=77]
[ext_resource path="res://resources/Characters/zombiefiles/png/female/Idle (13).png" type="Texture" id=78]
[ext_resource path="res://resources/Characters/zombiefiles/png/female/Idle (14).png" type="Texture" id=79]
[ext_resource path="res://resources/Characters/zombiefiles/png/female/Idle (15).png" type="Texture" id=80]
[ext_resource path="res://resources/Characters/zombiefiles/png/male/Walk (1).png" type="Texture" id=81]
[ext_resource path="res://resources/Characters/zombiefiles/png/male/Walk (2).png" type="Texture" id=82]
[ext_resource path="res://resources/Characters/zombiefiles/png/male/Walk (3).png" type="Texture" id=83]
[ext_resource path="res://resources/Characters/zombiefiles/png/male/Walk (4).png" type="Texture" id=84]
[ext_resource path="res://resources/Characters/zombiefiles/png/male/Walk (5).png" type="Texture" id=85]
[ext_resource path="res://resources/Characters/zombiefiles/png/male/Walk (6).png" type="Texture" id=86]
[ext_resource path="res://resources/Characters/zombiefiles/png/male/Walk (7).png" type="Texture" id=87]
[ext_resource path="res://resources/Characters/zombiefiles/png/male/Walk (8).png" type="Texture" id=88]
[ext_resource path="res://resources/Characters/zombiefiles/png/male/Walk (9).png" type="Texture" id=89]
[ext_resource path="res://resources/Characters/zombiefiles/png/male/Walk (10).png" type="Texture" id=90]

[sub_resource type="GDScript" id=1]
script/source = "extends \"res://Scenes/Characters/generic_character_behaviour.gd\"

# variables
var bubbleSpaceReact

var genders = ['female', 'male']
var moveDirections = [-1, 1]
var gender = genders[randi()%2]
var enemy_barriers = null
var defaultMaxSpeed

onready var healthBar = get_node(\"ProgressBar\")


func _ready():
	type = gender+\"_zombie\"
	playerSprite = get_node(\"AnimatedSprite\")
	playerSprite.animation = type + \"_walk\"
	bubbleSpaceReact = get_node(\"React - Area2D\")
	repeatFrames = true
	maxSpeed = 130
	defaultMaxSpeed = maxSpeed
	health = 30
	maxHealth = 30
	invincibleTime = 1
	dazedTime = 1.2
	healthBar.max_value = maxHealth
	
	if (gender == 'female'):
		playerSprite.scale = Vector2(0.13, 0.13)
	
	_subscribe_to_signals()
	set_process(true)
	pass
	
	
func _subscribe_to_signals():
	enemy_barriers = get_tree().get_nodes_in_group(\"barrier\")
	for i in enemy_barriers:
		i.connect(\"touchedBarrier\", self, \"change_direction\")
	

func _process(delta):
	._animate_player(delta)
	healthBar.value = health
		
	if (!dazed):
		_areaCheck()
		
		if (movementDirection == 0):
			if (moveDirections[randi()%2] == -1):
				._move_left()
			else:
				._move_right()
		
		#warning-ignore:return_value_discarded
		move_and_collide(Vector2(0, velocity.y))
		var collidedObject2 = move_and_collide(Vector2(velocity.x, 0))
		
		if (collidedObject2 and health > 0):
			if (collidedObject2.normal == Vector2(0,-1)):
				playerSpeedY = 0
			if (collidedObject2.normal == Vector2(1,0)):
				._move_right()
			elif (collidedObject2.normal == Vector2(-1,0)):
				._move_left()
		
	if(health <= 0):
		healthBar.hide()
		self.get_node(\"CollisionShape2D\").disabled = true
	elif(action1):
		playerSprite.animation = type + \"_attack\"
		repeatFrames = true
	elif(dazed):
		playerSprite.animation = type + \"_idle\"
		facingDirection = 0
		movementDirection = 0
		action1 = false
		action2 = false
		action3 = false
	else:
		playerSprite.animation = type + \"_walk\"
		maxSpeed = defaultMaxSpeed
	
	pass
	
	
func _areaCheck():
	if (health > 0):
		var area = bubbleSpaceReact.get_overlapping_bodies()
		action1 = false
		if (area.size() != 0):
			for body in area:
#				Move zombie in character direction 
				if (body.is_in_group(\"character\")):
					action1 = true
					if (body.position.x < self.position.x):
						._move_left()
					elif (body.position.x > self.position.x):
						._move_right()
					
					if (maxSpeed == defaultMaxSpeed):
						maxSpeed *= 2
	pass
	
	
# Triggered via touchedBarrier signal to turn around
func change_direction(body, barrier):
	if (self == body):
		if (body.position.x < barrier.position.x):
			._move_left()
		else:
			._move_right()

	pass
	
	"

[sub_resource type="RectangleShape2D" id=2]
extents = Vector2( 1.2908, 34.4196 )

[sub_resource type="SpriteFrames" id=3]
animations = [ {
"frames": [ ExtResource( 1 ), ExtResource( 2 ), ExtResource( 3 ), ExtResource( 4 ), ExtResource( 5 ), ExtResource( 6 ), ExtResource( 7 ), ExtResource( 8 ), ExtResource( 9 ), ExtResource( 10 ), ExtResource( 11 ), ExtResource( 12 ) ],
"loop": true,
"name": "female_zombie_dead",
"speed": 5.0
}, {
"frames": [ ExtResource( 13 ), ExtResource( 14 ), ExtResource( 15 ), ExtResource( 16 ), ExtResource( 17 ), ExtResource( 18 ), ExtResource( 19 ), ExtResource( 20 ) ],
"loop": true,
"name": "female_zombie_attack",
"speed": 5.0
}, {
"frames": [ ExtResource( 21 ), ExtResource( 22 ), ExtResource( 23 ), ExtResource( 24 ), ExtResource( 25 ), ExtResource( 26 ), ExtResource( 27 ), ExtResource( 28 ), ExtResource( 29 ), ExtResource( 30 ), ExtResource( 31 ), ExtResource( 32 ) ],
"loop": true,
"name": "male_zombie_dead",
"speed": 5.0
}, {
"frames": [ ExtResource( 33 ), ExtResource( 34 ), ExtResource( 35 ), ExtResource( 36 ), ExtResource( 37 ), ExtResource( 38 ), ExtResource( 39 ), ExtResource( 40 ), ExtResource( 41 ), ExtResource( 42 ), ExtResource( 43 ), ExtResource( 44 ), ExtResource( 45 ), ExtResource( 46 ), ExtResource( 47 ) ],
"loop": true,
"name": "male_zombie_idle",
"speed": 5.0
}, {
"frames": [ ExtResource( 48 ), ExtResource( 49 ), ExtResource( 50 ), ExtResource( 51 ), ExtResource( 52 ), ExtResource( 53 ), ExtResource( 54 ), ExtResource( 55 ), ExtResource( 56 ), ExtResource( 57 ) ],
"loop": true,
"name": "female_zombie_walk",
"speed": 4.98
}, {
"frames": [ ExtResource( 58 ), ExtResource( 59 ), ExtResource( 60 ), ExtResource( 61 ), ExtResource( 62 ), ExtResource( 63 ), ExtResource( 64 ), ExtResource( 65 ) ],
"loop": true,
"name": "male_zombie_attack",
"speed": 5.0
}, {
"frames": [ ExtResource( 66 ), ExtResource( 67 ), ExtResource( 68 ), ExtResource( 69 ), ExtResource( 70 ), ExtResource( 71 ), ExtResource( 72 ), ExtResource( 73 ), ExtResource( 74 ), ExtResource( 75 ), ExtResource( 76 ), ExtResource( 77 ), ExtResource( 78 ), ExtResource( 79 ), ExtResource( 80 ) ],
"loop": true,
"name": "female_zombie_idle",
"speed": 5.0
}, {
"frames": [ ExtResource( 81 ), ExtResource( 82 ), ExtResource( 83 ), ExtResource( 84 ), ExtResource( 85 ), ExtResource( 86 ), ExtResource( 87 ), ExtResource( 88 ), ExtResource( 89 ), ExtResource( 90 ) ],
"loop": true,
"name": "male_zombie_walk",
"speed": 5.0
} ]

[sub_resource type="RectangleShape2D" id=4]
extents = Vector2( 112.876, 32.9578 )

[sub_resource type="StyleBoxFlat" id=5]
bg_color = Color( 0.760784, 0.184314, 0.184314, 1 )

[sub_resource type="StyleBoxFlat" id=6]

[node name="Enemy" type="KinematicBody2D" groups=[
"enemy_character",
]]
position = Vector2( -0.0189209, 1.0983 )
scale = Vector2( 1.2, 1.2 )
script = SubResource( 1 )

[node name="CollisionShape2D" type="CollisionShape2D" parent="." groups=[
"Enemy_drop",
]]
editor/display_folded = true
position = Vector2( -4.58939, -6.7816 )
scale = Vector2( 5.65976, 0.847504 )
shape = SubResource( 2 )

[node name="AnimatedSprite" type="AnimatedSprite" parent="."]
editor/display_folded = true
position = Vector2( 0.715809, -5.54256 )
scale = Vector2( 0.15, 0.15 )
frames = SubResource( 3 )
animation = "female_zombie_idle"
speed_scale = 1.5

[node name="React - Area2D" type="Area2D" parent="."]

[node name="CollisionShape2D" type="CollisionShape2D" parent="React - Area2D"]
position = Vector2( 0, -10.6946 )
shape = SubResource( 4 )

[node name="Tween" type="Tween" parent="."]

[node name="ProgressBar" type="ProgressBar" parent="."]
margin_left = -12.0
margin_top = -46.7567
margin_right = 71.0
margin_bottom = -32.7567
rect_scale = Vector2( 0.3, 0.3 )
custom_styles/fg = SubResource( 5 )
custom_styles/bg = SubResource( 6 )
